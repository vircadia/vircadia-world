{
  email {$CADDY_EMAIL}
}

{$CADDY_DOMAIN_API} {
  {$CADDY_TLS_API}
  encode zstd gzip

  # Route WebSocket, REST auth, and REST asset subpaths to their managers
  @ws path /world/ws
  reverse_proxy @ws http://{$CADDY_UPSTREAM_API_WS}

  @rest_auth path /world/rest/auth*
  reverse_proxy @rest_auth http://{$CADDY_UPSTREAM_API_AUTH}

  @rest_asset path /world/rest/asset*
  reverse_proxy @rest_asset http://{$CADDY_UPSTREAM_API_ASSET}
}

{$CADDY_DOMAIN_APP} {
  {$CADDY_TLS_APP}
  encode zstd gzip

  # Proxy app traffic to the prod web server container
  reverse_proxy http://{$CADDY_UPSTREAM_APP}
}
